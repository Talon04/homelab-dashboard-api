{% extends "_base.html" %}

{% block title %}Homelab Dashboard - Code Editor{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/neo.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const res = await fetch('/api/config/modules');
            if (res.ok) {
                const data = await res.json();
                const enabled = Array.isArray(data.modules) ? data.modules : [];
                if (!enabled.includes('code_editor')) {
                    window.location.href = '/settings';
                }
            }
        } catch (e) { }
    });
</script>
{% endblock %}

{% block content %}
<div class="grid grid-cols-12 gap-4">
    <div class="col-span-3 bg-white rounded shadow p-3">
        <div class="flex justify-between items-center mb-2">
            <h2 class="font-semibold">Files</h2>
            <button id="new-file" class="px-2 py-1 text-sm bg-blue-500 text-white rounded">New</button>
        </div>
        <div id="file-tree" class="text-sm"></div>
    </div>
    <div class="col-span-6 bg-white rounded shadow p-3">
        <div class="flex justify-between items-center mb-2">
            <div class="font-semibold" id="editor-path">No file selected</div>
            <div class="space-x-2">
                <button id="save-file" class="px-2 py-1 text-sm bg-green-500 text-white rounded">Save</button>
                <button id="run-file" class="px-2 py-1 text-sm bg-gray-700 text-white rounded">Run</button>
                <button id="delete-file" class="px-2 py-1 text-sm bg-red-500 text-white rounded">Delete</button>
            </div>
        </div>
        <textarea id="editor" class="w-full h-[60vh] p-2 border border-gray-300 rounded font-mono text-sm"></textarea>
    </div>
    <div class="col-span-3 bg-white rounded shadow p-3">
        <div class="flex justify-between items-center mb-2">
            <h2 class="font-semibold">Console</h2>
            <button id="clear-console" class="px-2 py-1 text-sm bg-gray-200 rounded">Clear</button>
        </div>
        <pre id="console" class="h-[60vh] overflow-auto bg-black text-green-200 p-2 text-xs rounded"></pre>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/code_editor.js" defer></script>
{% endblock %}